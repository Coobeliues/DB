<html>
<head>
<title>console.sql</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
console.sql</font>
</center></td></tr></table>
<pre><span class="s0">CREATE table </span><span class="s1">dealer (</span>
    <span class="s1">id </span><span class="s0">integer primary key,</span>
    <span class="s0">name varchar</span><span class="s1">(</span><span class="s2">255</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s0">locatiON varchar</span><span class="s1">(</span><span class="s2">255</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">charge </span><span class="s0">float</span>
<span class="s1">)</span><span class="s0">;</span>

<span class="s0">INSERT INTO </span><span class="s1">dealer (id</span><span class="s0">, name, locatiON, </span><span class="s1">charge) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">101</span><span class="s0">, </span><span class="s3">'Ерлан'</span><span class="s0">, </span><span class="s3">'Алматы'</span><span class="s0">, </span><span class="s2">0.15</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">dealer (id</span><span class="s0">, name, locatiON, </span><span class="s1">charge) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">102</span><span class="s0">, </span><span class="s3">'Жасмин'</span><span class="s0">, </span><span class="s3">'Караганда'</span><span class="s0">, </span><span class="s2">0.13</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">dealer (id</span><span class="s0">, name, locatiON, </span><span class="s1">charge) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">105</span><span class="s0">, </span><span class="s3">'Азамат'</span><span class="s0">, </span><span class="s3">'Нур-Султан'</span><span class="s0">, </span><span class="s2">0.11</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">dealer (id</span><span class="s0">, name, locatiON, </span><span class="s1">charge) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">106</span><span class="s0">, </span><span class="s3">'Канат'</span><span class="s0">, </span><span class="s3">'Караганда'</span><span class="s0">, </span><span class="s2">0.14</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">dealer (id</span><span class="s0">, name, locatiON, </span><span class="s1">charge) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">107</span><span class="s0">, </span><span class="s3">'Евгений'</span><span class="s0">, </span><span class="s3">'Атырау'</span><span class="s0">, </span><span class="s2">0.13</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">dealer (id</span><span class="s0">, name, locatiON, </span><span class="s1">charge) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">103</span><span class="s0">, </span><span class="s3">'Жулдыз'</span><span class="s0">, </span><span class="s3">'Актобе'</span><span class="s0">, </span><span class="s2">0.12</span><span class="s1">)</span><span class="s0">;</span>

<span class="s0">CREATE table </span><span class="s1">client (</span>
    <span class="s1">id </span><span class="s0">integer primary key,</span>
    <span class="s0">name varchar</span><span class="s1">(</span><span class="s2">255</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">city </span><span class="s0">varchar</span><span class="s1">(</span><span class="s2">255</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">priority </span><span class="s0">integer,</span>
    <span class="s1">dealer_id </span><span class="s0">integer references </span><span class="s1">dealer(id)</span>
<span class="s1">)</span><span class="s0">;</span>

<span class="s0">INSERT INTO </span><span class="s1">client (id</span><span class="s0">, name, </span><span class="s1">city</span><span class="s0">, </span><span class="s1">priority</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">802</span><span class="s0">, </span><span class="s3">'Айша'</span><span class="s0">, </span><span class="s3">'Алматы'</span><span class="s0">, </span><span class="s2">100</span><span class="s0">, </span><span class="s2">101</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">client (id</span><span class="s0">, name, </span><span class="s1">city</span><span class="s0">, </span><span class="s1">priority</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">807</span><span class="s0">, </span><span class="s3">'Даулет'</span><span class="s0">, </span><span class="s3">'Алматы'</span><span class="s0">, </span><span class="s2">200</span><span class="s0">, </span><span class="s2">101</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">client (id</span><span class="s0">, name, </span><span class="s1">city</span><span class="s0">, </span><span class="s1">priority</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">805</span><span class="s0">, </span><span class="s3">'Али'</span><span class="s0">, </span><span class="s3">'Кокшетау'</span><span class="s0">, </span><span class="s2">200</span><span class="s0">, </span><span class="s2">102</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">client (id</span><span class="s0">, name, </span><span class="s1">city</span><span class="s0">, </span><span class="s1">priority</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">808</span><span class="s0">, </span><span class="s3">'Ильяс'</span><span class="s0">, </span><span class="s3">'Нур-Султан'</span><span class="s0">, </span><span class="s2">300</span><span class="s0">, </span><span class="s2">102</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">client (id</span><span class="s0">, name, </span><span class="s1">city</span><span class="s0">, </span><span class="s1">priority</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">804</span><span class="s0">, </span><span class="s3">'Алия'</span><span class="s0">, </span><span class="s3">'Караганда'</span><span class="s0">, </span><span class="s2">300</span><span class="s0">, </span><span class="s2">106</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">client (id</span><span class="s0">, name, </span><span class="s1">city</span><span class="s0">, </span><span class="s1">priority</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">809</span><span class="s0">, </span><span class="s3">'Саша'</span><span class="s0">, </span><span class="s3">'Шымкент'</span><span class="s0">, </span><span class="s2">100</span><span class="s0">, </span><span class="s2">103</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">client (id</span><span class="s0">, name, </span><span class="s1">city</span><span class="s0">, </span><span class="s1">priority</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">803</span><span class="s0">, </span><span class="s3">'Маша'</span><span class="s0">, </span><span class="s3">'Семей'</span><span class="s0">, </span><span class="s2">200</span><span class="s0">, </span><span class="s2">107</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">client (id</span><span class="s0">, name, </span><span class="s1">city</span><span class="s0">, </span><span class="s1">priority</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">801</span><span class="s0">, </span><span class="s3">'Максат'</span><span class="s0">, </span><span class="s3">'Нур-Султан'</span><span class="s0">, null, </span><span class="s2">105</span><span class="s1">)</span><span class="s0">;</span>

<span class="s0">CREATE table </span><span class="s1">sell (</span>
    <span class="s1">id </span><span class="s0">integer primary key,</span>
    <span class="s1">amount </span><span class="s0">float,</span>
    <span class="s0">date timestamp,</span>
    <span class="s1">client_id </span><span class="s0">integer references </span><span class="s1">client(id)</span><span class="s0">,</span>
    <span class="s1">dealer_id </span><span class="s0">integer references </span><span class="s1">dealer(id)</span>
<span class="s1">)</span><span class="s0">;</span>

<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">201</span><span class="s0">, </span><span class="s2">150.5</span><span class="s0">, </span><span class="s3">'2012-10-05 00:00:00.000000'</span><span class="s0">, </span><span class="s2">805</span><span class="s0">, </span><span class="s2">102</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">209</span><span class="s0">, </span><span class="s2">270.65</span><span class="s0">, </span><span class="s3">'2012-09-10 00:00:00.000000'</span><span class="s0">, </span><span class="s2">801</span><span class="s0">, </span><span class="s2">105</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">202</span><span class="s0">, </span><span class="s2">65.26</span><span class="s0">, </span><span class="s3">'2012-10-05 00:00:00.000000'</span><span class="s0">, </span><span class="s2">802</span><span class="s0">, </span><span class="s2">101</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">204</span><span class="s0">, </span><span class="s2">110.5</span><span class="s0">, </span><span class="s3">'2012-08-17 00:00:00.000000'</span><span class="s0">, </span><span class="s2">809</span><span class="s0">, </span><span class="s2">103</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">207</span><span class="s0">, </span><span class="s2">948.5</span><span class="s0">, </span><span class="s3">'2012-09-10 00:00:00.000000'</span><span class="s0">, </span><span class="s2">805</span><span class="s0">, </span><span class="s2">102</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">205</span><span class="s0">, </span><span class="s2">2400.6</span><span class="s0">, </span><span class="s3">'2012-07-27 00:00:00.000000'</span><span class="s0">, </span><span class="s2">807</span><span class="s0">, </span><span class="s2">101</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">208</span><span class="s0">, </span><span class="s2">5760</span><span class="s0">, </span><span class="s3">'2012-09-10 00:00:00.000000'</span><span class="s0">, </span><span class="s2">802</span><span class="s0">, </span><span class="s2">101</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">210</span><span class="s0">, </span><span class="s2">1983.43</span><span class="s0">, </span><span class="s3">'2012-10-10 00:00:00.000000'</span><span class="s0">, </span><span class="s2">804</span><span class="s0">, </span><span class="s2">106</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">203</span><span class="s0">, </span><span class="s2">2480.4</span><span class="s0">, </span><span class="s3">'2012-10-10 00:00:00.000000'</span><span class="s0">, </span><span class="s2">809</span><span class="s0">, </span><span class="s2">103</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">212</span><span class="s0">, </span><span class="s2">250.45</span><span class="s0">, </span><span class="s3">'2012-06-27 00:00:00.000000'</span><span class="s0">, </span><span class="s2">808</span><span class="s0">, </span><span class="s2">102</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">211</span><span class="s0">, </span><span class="s2">75.29</span><span class="s0">, </span><span class="s3">'2012-08-17 00:00:00.000000'</span><span class="s0">, </span><span class="s2">803</span><span class="s0">, </span><span class="s2">107</span><span class="s1">)</span><span class="s0">;</span>
<span class="s0">INSERT INTO </span><span class="s1">sell (id</span><span class="s0">, </span><span class="s1">amount</span><span class="s0">, date, </span><span class="s1">client_id</span><span class="s0">, </span><span class="s1">dealer_id) </span><span class="s0">VALUES </span><span class="s1">(</span><span class="s2">213</span><span class="s0">, </span><span class="s2">3045.6</span><span class="s0">, </span><span class="s3">'2012-04-25 00:00:00.000000'</span><span class="s0">, </span><span class="s2">802</span><span class="s0">, </span><span class="s2">101</span><span class="s1">)</span><span class="s0">;</span>

<span class="s4">-- drop table client;</span>
<span class="s4">-- drop table dealer;</span>
<span class="s4">-- drop table sell;</span>

<span class="s4">------------------------------------------------------------------------------------------------------------------------</span>
<span class="s4">-- 1.a</span>
<span class="s0">SELECT </span><span class="s1">* </span><span class="s0">FROM </span><span class="s1">dealer </span><span class="s0">INNER JOIN </span><span class="s1">client </span><span class="s0">ON </span><span class="s1">dealer.id = client.dealer_id</span><span class="s0">;</span>

<span class="s4">-- 1.b</span>
<span class="s0">SELECT d, c</span><span class="s1">.name</span><span class="s0">, c</span><span class="s1">.city</span><span class="s0">, c</span><span class="s1">.priority</span><span class="s0">, s</span><span class="s1">.id</span><span class="s0">, s</span><span class="s1">.date</span><span class="s0">, s</span><span class="s1">.amount </span><span class="s0">FROM </span><span class="s1">dealer </span><span class="s0">d</span>
<span class="s0">LEFT JOIN </span><span class="s1">client </span><span class="s0">c ON d</span><span class="s1">.id = </span><span class="s0">c</span><span class="s1">.dealer_id</span>
<span class="s0">LEFT JOIN </span><span class="s1">sell </span><span class="s0">s ON c</span><span class="s1">.id = </span><span class="s0">s</span><span class="s1">.client_id</span>
<span class="s0">WHERE c</span><span class="s1">.name </span><span class="s0">IS NOT NULL AND c</span><span class="s1">.city </span><span class="s0">IS NOT NULL</span>
<span class="s0">AND c</span><span class="s1">.priority </span><span class="s0">IS NOT NULL</span>
<span class="s0">AND s</span><span class="s1">.id </span><span class="s0">IS NOT NULL</span>
<span class="s0">AND s</span><span class="s1">.date </span><span class="s0">IS NOT NULL</span>
<span class="s0">AND s</span><span class="s1">.amount </span><span class="s0">IS NOT NULL ;</span>

<span class="s4">-- 1.c</span>
<span class="s0">SELECT d, c FROM </span><span class="s1">dealer </span><span class="s0">d</span>
<span class="s0">INNER JOIN </span><span class="s1">client </span><span class="s0">c ON c</span><span class="s1">.city = </span><span class="s0">d</span><span class="s1">.locatiON</span><span class="s0">;</span>

<span class="s4">-- 1.d</span>
<span class="s0">SELECT s</span><span class="s1">.id</span><span class="s0">, s</span><span class="s1">.amount</span><span class="s0">, c</span><span class="s1">.name</span><span class="s0">, c</span><span class="s1">.city </span><span class="s0">FROM </span><span class="s1">sell </span><span class="s0">s</span>
<span class="s0">INNER JOIN </span><span class="s1">client </span><span class="s0">c ON s</span><span class="s1">.client_id = </span><span class="s0">c</span><span class="s1">.id</span>
<span class="s0">WHERE s</span><span class="s1">.amount &gt;= </span><span class="s2">100 </span><span class="s0">AND s</span><span class="s1">.amount &lt;= </span><span class="s2">500</span><span class="s0">;</span>

<span class="s4">-- 1.e</span>
<span class="s0">SELECT </span><span class="s1">* </span><span class="s0">FROM </span><span class="s1">dealer </span><span class="s0">d LEFT JOIN </span><span class="s1">client </span><span class="s0">c ON d</span><span class="s1">.locatiON = </span><span class="s0">c</span><span class="s1">.city</span><span class="s0">;</span>

<span class="s4">-- 1.f</span>
<span class="s0">SELECT c</span><span class="s1">.name</span><span class="s0">, c</span><span class="s1">.city</span><span class="s0">, d</span><span class="s1">.name</span><span class="s0">, d</span><span class="s1">.charge </span><span class="s0">FROM </span><span class="s1">client </span><span class="s0">c JOIN </span><span class="s1">dealer </span><span class="s0">d ON c</span><span class="s1">.dealer_id = </span><span class="s0">d</span><span class="s1">.id</span><span class="s0">;</span>

<span class="s4">-- 1.g</span>
<span class="s0">SELECT c</span><span class="s1">.name</span><span class="s0">, c</span><span class="s1">.city</span><span class="s0">, d FROM </span><span class="s1">client </span><span class="s0">c JOIN </span><span class="s1">dealer </span><span class="s0">d ON </span><span class="s1">dealer_id = </span><span class="s0">d</span><span class="s1">.id</span>
<span class="s0">WHERE d</span><span class="s1">.charge &gt; </span><span class="s2">0.12</span><span class="s0">;</span>

<span class="s4">-- 1.h</span>
<span class="s0">SELECT c</span><span class="s1">.name</span><span class="s0">, c</span><span class="s1">.city</span><span class="s0">, s</span><span class="s1">.id</span><span class="s0">, s</span><span class="s1">.date</span><span class="s0">, s</span><span class="s1">.amount</span><span class="s0">, d</span><span class="s1">.name</span><span class="s0">, d</span><span class="s1">.charge </span><span class="s0">FROM </span><span class="s1">client </span><span class="s0">c</span>
<span class="s0">JOIN </span><span class="s1">dealer </span><span class="s0">d ON c</span><span class="s1">.dealer_id = </span><span class="s0">d</span><span class="s1">.id</span>
<span class="s0">JOIN </span><span class="s1">sell </span><span class="s0">s ON c</span><span class="s1">.id = </span><span class="s0">s</span><span class="s1">.client_id</span><span class="s0">;</span>

<span class="s4">-- 1.i</span>
<span class="s0">SELECT </span><span class="s1">client.name</span><span class="s0">,</span><span class="s1">client.city</span><span class="s0">, </span><span class="s1">client.priority</span><span class="s0">,</span><span class="s1">dealer.name</span><span class="s0">, </span><span class="s1">sell.id</span><span class="s0">,</span><span class="s1">sell.amount</span>
<span class="s0">FROM </span><span class="s1">client </span><span class="s0">RIGHT OUTER JOIN </span><span class="s1">dealer </span><span class="s0">ON </span><span class="s1">client.dealer_id = dealer.id</span>
    <span class="s0">LEFT OUTER JOIN </span><span class="s1">sell </span><span class="s0">ON </span><span class="s1">client.id = sell.client_id</span>
<span class="s0">WHERE </span><span class="s1">amount &gt;= </span><span class="s2">2000 </span><span class="s0">AND </span><span class="s1">client.priority </span><span class="s0">IS NOT NULL;</span>

<span class="s4">-- 2.a</span>
<span class="s0">CREATE VIEW </span><span class="s1">cass</span>
<span class="s0">AS SELECT s</span><span class="s1">.date</span><span class="s0">, </span><span class="s1">count(</span><span class="s0">distinct s</span><span class="s1">.client_id)</span><span class="s0">, </span><span class="s1">avg(</span><span class="s0">s</span><span class="s1">.amount)</span><span class="s0">, </span><span class="s1">sum(</span><span class="s0">s</span><span class="s1">.amount) </span><span class="s0">FROM </span><span class="s1">sell </span><span class="s0">s GROUP BY s</span><span class="s1">.date</span><span class="s0">;</span>

<span class="s4">-- 2.b</span>
<span class="s0">CREATE VIEW </span><span class="s1">abcd</span>
<span class="s0">AS SELECT s</span><span class="s1">.date</span><span class="s0">, s</span><span class="s1">.amount </span><span class="s0">FROM </span><span class="s1">sell </span><span class="s0">s</span>
<span class="s0">ORDER BY s</span><span class="s1">.amount </span><span class="s0">desc limit </span><span class="s2">5</span><span class="s0">;</span>

<span class="s4">-- 2.c</span>
<span class="s0">CREATE VIEW </span><span class="s1">casd</span>
<span class="s0">AS SELECT d, </span><span class="s1">count(</span><span class="s0">s</span><span class="s1">.amount)</span><span class="s0">, </span><span class="s1">avg(</span><span class="s0">s</span><span class="s1">.amount)</span><span class="s0">, </span><span class="s1">sum(</span><span class="s0">s</span><span class="s1">.amount) </span><span class="s0">FROM </span><span class="s1">sell </span><span class="s0">s</span>
<span class="s0">JOIN </span><span class="s1">dealer </span><span class="s0">d ON d</span><span class="s1">.id = </span><span class="s0">s</span><span class="s1">.dealer_id </span><span class="s0">GROUP BY d;</span>

<span class="s4">-- 2.d</span>
<span class="s0">CREATE VIEW </span><span class="s1">sd</span>
<span class="s0">AS SELECT d, </span><span class="s1">sum(amount * </span><span class="s0">d</span><span class="s1">.charge) </span><span class="s0">FROM </span><span class="s1">sell </span><span class="s0">s</span>
<span class="s0">JOIN </span><span class="s1">dealer </span><span class="s0">d ON d</span><span class="s1">.id = </span><span class="s0">s</span><span class="s1">.dealer_id </span><span class="s0">GROUP BY d;</span>

<span class="s4">-- 2.e</span>
<span class="s0">CREATE VIEW </span><span class="s1">casej</span>
<span class="s0">AS SELECT d</span><span class="s1">.locatiON</span><span class="s0">, </span><span class="s1">count(</span><span class="s0">s</span><span class="s1">.amount)</span><span class="s0">, </span><span class="s1">avg(</span><span class="s0">s</span><span class="s1">.amount)</span><span class="s0">, </span><span class="s1">sum(</span><span class="s0">s</span><span class="s1">.amount) </span><span class="s0">FROM </span><span class="s1">dealer </span><span class="s0">d</span>
<span class="s0">JOIN </span><span class="s1">sell </span><span class="s0">s ON d</span><span class="s1">.id = </span><span class="s0">s</span><span class="s1">.dealer_id </span><span class="s0">GROUP BY d</span><span class="s1">.locatiON</span><span class="s0">;</span>

<span class="s4">-- 2.f</span>
<span class="s0">CREATE VIEW </span><span class="s1">casef</span>
<span class="s0">AS SELECT c</span><span class="s1">.city</span><span class="s0">, </span><span class="s1">count(</span><span class="s0">s</span><span class="s1">.amount)</span><span class="s0">, </span><span class="s1">avg(</span><span class="s0">s</span><span class="s1">.amount * (</span><span class="s0">d</span><span class="s1">.charge + </span><span class="s2">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">sum(</span><span class="s0">s</span><span class="s1">.amount * (</span><span class="s0">d</span><span class="s1">.charge + </span><span class="s2">1</span><span class="s1">)) </span><span class="s0">FROM </span><span class="s1">client </span><span class="s0">c</span>
<span class="s0">JOIN </span><span class="s1">dealer </span><span class="s0">d ON c</span><span class="s1">.dealer_id = </span><span class="s0">d</span><span class="s1">.id</span>
<span class="s0">JOIN </span><span class="s1">sell </span><span class="s0">s ON c</span><span class="s1">.id = </span><span class="s0">s</span><span class="s1">.client_id </span><span class="s0">GROUP BY c</span><span class="s1">.city</span><span class="s0">;</span>

<span class="s4">-- 2.g</span>
<span class="s0">CREATE VIEW </span><span class="s1">gg</span>
<span class="s0">AS SELECT c</span><span class="s1">.city</span><span class="s0">, </span><span class="s1">sum(</span><span class="s0">s</span><span class="s1">.amount * (</span><span class="s0">d</span><span class="s1">.charge + </span><span class="s2">1</span><span class="s1">)) </span><span class="s0">AS </span><span class="s1">totalexpense</span><span class="s0">, </span><span class="s1">sum(</span><span class="s0">s</span><span class="s1">.amount) </span><span class="s0">AS </span><span class="s1">totalamount </span><span class="s0">FROM </span><span class="s1">client </span><span class="s0">c</span>
<span class="s0">JOIN </span><span class="s1">sell </span><span class="s0">s ON c</span><span class="s1">.id = </span><span class="s0">s</span><span class="s1">.client_id</span>
<span class="s0">JOIN </span><span class="s1">dealer </span><span class="s0">d ON s</span><span class="s1">.dealer_id = </span><span class="s0">d</span><span class="s1">.id </span><span class="s0">AND c</span><span class="s1">.city = </span><span class="s0">d</span><span class="s1">.locatiON </span><span class="s0">GROUP BY c</span><span class="s1">.city</span><span class="s0">;</span>

<span class="s0">drop VIEW </span><span class="s1">cass</span><span class="s0">;</span>
<span class="s0">drop VIEW </span><span class="s1">abcd</span><span class="s0">;</span>
<span class="s0">drop VIEW </span><span class="s1">casd</span><span class="s0">;</span>
<span class="s0">drop VIEW </span><span class="s1">sd</span><span class="s0">;</span>
<span class="s0">drop VIEW </span><span class="s1">casej</span><span class="s0">;</span>
<span class="s0">drop VIEW </span><span class="s1">casef</span><span class="s0">;</span>
<span class="s0">drop VIEW </span><span class="s1">gg</span><span class="s0">;</span></pre>
</body>
</html>